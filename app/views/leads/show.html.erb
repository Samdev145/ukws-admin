
<div class="row g-0">
  <div class="col-md-4">
    <h1>Lead</h1>
  </div>

  <div class="col-md-8" style="position: relative;">
    <%= link_to(
        'Open in CRM',
        @lead.link_address,
        target: "_blank",
        class: "btn btn-success",
        style: "margin-bottom: 0.5rem; position: absolute; bottom: 0; right: 0;"
      )
    %>
  </div>
</div>

<table class="table">
  <tr>
    <th>Full Name</th>
    <td><%= @lead.full_name %></td>
  </tr>
  <tr>
    <th>Email</th>
    <td><%= @lead.email %></td>
  </tr>
  <tr>
    <th>Water Softener</th>
    <td><%= @lead.water_softener_model %></td>
  </tr>
  <tr>
    <th>Water Softener Warranty</th>
    <td><%= @lead.softener_warranty_details %></td>
  </tr>
  <tr>
    <th>Packs of Block Salt</th>
    <td><%= @lead.salt_quantity %></td>
  </tr>
  <tr>
    <th>Installation Type</th>
    <td><%= @lead.installation_type %></td>
  </tr>
  <tr>
    <th>Drinking Tap</th>
    <td><%= @lead.drinking_taps %></td>
  </tr>
  <tr>
    <th>Drinking Water Filter</th>
    <td><%= @lead.drinking_water_filter %></td>
  </tr>

  <tr>
    <th>To be installed by</th>
    <td><%= @lead.installed_by %></td>
  </tr>
</table>


<h2>Installation Details</h2>

<% if @appointment && @appointment.errors %>
  <div class="alert alert-danger" role="alert">
    <p>Unable to book installation due to the following errors:</p>
    <ul>
      <% @appointment.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<% if @errors.any? %>
  <div class="alert alert-danger" role="alert">
    <p>Unable to book installation due to the following errors:</p>
    <ul>
      <% @errors.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<% if @installer.present? %>

  <%= form_tag(book_appointment_lead_path) do -%>
    <%= hidden_field_tag 'id', @lead.id %>

    <div class="mb-3 row">
      <%= label_tag(:start_time, 'Start Time', class: 'col-sm-2 col-form-label') %>
      <div class="col-sm-10">
        <%= time_field_tag "start_time", @installer.preferred_start_time.to_formatted_s(:time) %>
      </div>
    </div>

    <div class="mb-3 row">
      <%= label_tag(:appointment_duration, 'Appointment Duration', class: 'col-sm-2 col-form-label') %>
      <div class="col-sm-10">
        <%= select_tag "appointment_duration", options_for_select(1..24, 4), class: 'form-select form-select-lg mb-3' %>
      </div>
    </div>

    <div class="mb-3 row">
      <%= label_tag(:test, 'Run Test', class: 'col-sm-2 col-form-label') %>
      <div class="col-sm-10">
        <%= check_box_tag 'test', 'yes', true %>
      </div>
    </div>

    <h4>Quotation</h4>

    <div class="mb-3 row">
      <div class="col-sm-4">
        <div><%= submit_tag 'Preview Quotation Email', class: "btn btn-primary", formaction: quotation_email_lead_path, formmethod: :get %></div>
      </div>
      <div class="col-sm-8">
        <div><%= submit_tag 'Send Quotation', class: "btn btn-success", formaction: send_quotation_lead_path %></div>
      </div>
    </div>

    <h4>Book Installation</h4>

    <div class="mb-3 row">
      <div class="col-sm-4">
        <div><%= submit_tag 'Preview Installation Email', class: "btn btn-primary", formaction: installation_email_lead_path, formmethod: :get %></div>
      </div>
      <div class="col-sm-8">
        <div><%= submit_tag 'Book Installation', class: "btn btn-success" %></div>
      </div>
    </div>
  <% end %>

<% end %>
